<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Tap - Tap2Earn</title>

  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js?56"></script>

  <!-- TMA Reward Ads -->
  <script src="https://js.onclckvd.com/in-stream-ad-admanager/tma.js"></script>

  <style>
    body { 
      margin: 0; padding: 0; 
      background: #ffffff;
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      justify-content: flex-start; 
      min-height: 100vh; 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
      touch-action: manipulation;
      color: #222;
    }

    #topNav {
      width: 100%;
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 50;
      background: #f8f9fa;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    #totalScoreBox {
      background: #e3f2fd;
      color: #1976d2;
      padding: 10px 16px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #walletNavBtn {
      background: #34a853;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    #tapArea {
      width: 220px;
      height: 220px;
      background: #f5f5f5;
      border: 4px dashed #ccc;
      border-radius: 50%;
      margin: 30px auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    #tapImage {
      width: 100px;
      height: 100px;
      animation: pulse 1.8s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.12); }
      100% { transform: scale(1); }
    }

    #energyContainer {
      width: 80%;
      max-width: 350px;
      background: #e0e0e0;
      height: 18px;
      border-radius: 10px;
      margin: 20px auto;
      overflow: hidden;
    }

    #energyBar {
      height: 100%;
      width: 100%;
      background: linear-gradient(90deg, #34a853, #66bb6a);
      border-radius: 10px;
      transition: width 0.3s ease;
    }

    #energyText {
      text-align: center;
      font-size: 16px;
      margin-top: 8px;
      font-weight: bold;
    }

    #rechargeBtn {
      background: #ff9800;
      color: white;
      border: none;
      padding: 16px 32px;
      border-radius: 30px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 20px;
      display: none;
      align-items: center;
      gap: 10px;
    }

    #rechargeBtn.show { display: flex; }

    #startScreen, #withdrawScreen {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      background: white;
      padding: 32px;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.12);
      max-width: 90%;
      z-index: 40;
      border: 1px solid #eee;
    }

    .btn {
      background: #4285f4;
      color: white;
      border: none;
      padding: 16px 32px;
      border-radius: 16px;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      margin: 12px auto;
    }
    .btn-wallet { background: #34a853; }
    .btn-close { background: #ea4335; }

  </style>
</head>

<body>

  <!-- TOP NAV -->
  <div id="topNav">
    <div id="totalScoreBox"><span>ðŸ“Š</span> Total: <span id="totalCount">0</span></div>
    <button id="walletNavBtn" onclick="openWithdraw()">
      <span>ðŸ’°</span> $<span id="topBalance">0.00</span>
    </button>
  </div>

  <!-- TAP AREA -->
  <div id="tapArea" onclick="tap()">
    <img id="tapImage" src="https://i.ibb.co.com/0jKk9nK/tap-coin-glow.png">
    <div class="score-big" id="currentScore">0</div>
  </div>

  <!-- ENERGY -->
  <div id="energyContainer">
    <div id="energyBar"></div>
  </div>
  <div id="energyText">Energy: 20 / 20</div>

  <!-- RECHARGE BUTTON -->
  <button id="rechargeBtn" onclick="playTMAReward()">
    <span>ðŸ“º</span> Watch Ad to Recharge
  </button>

  <!-- START SCREEN -->
  <div id="startScreen">
    <h1 style="color:#4285f4;">ðŸ‘† Smart Tap2Earn</h1>
    <div>Total Score: <span id="startTotal">0</span></div>

    <div style="margin-top:10px;">
      100,000 Score = $1.00
    </div>

    <button class="btn" onclick="startTapping()">START TAPPING</button>
    <button class="btn btn-wallet" onclick="openWithdraw()">Wallet</button>
  </div>

  <!-- WITHDRAW SCREEN -->
  <div id="withdrawScreen" style="display:none;">
    <h2>ðŸ’° Litecoin Withdraw</h2>
    <div>Score: <span id="withdrawTotal">0</span></div>
    <div style="font-size:26px;">$<span id="balanceDisplay">0.00</span></div>

    <input type="text" id="ltcAddress" placeholder="LTC Address..." style="width:100%; padding:12px;">

    <button class="btn" id="withdrawBtn" disabled>
      Withdraw $<span id="withdrawAmount">0.00</span>
    </button>

    <button class="btn btn-close" onclick="closeWithdraw()">Close</button>
  </div>

  <!-- GAME SCRIPT + TMA ADS -->
  <script>
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    const TOTAL_SCORE_KEY = "tap2earn_totalScore";
    const LTC_ADDRESS_KEY = "tap2earn_ltcAddress";

    let totalScore = parseInt(localStorage.getItem(TOTAL_SCORE_KEY)) || 0;
    let energy = 20;
    const MAX_ENERGY = 20;
    let isTapping = false;
    let currentScore = 0;

    const startScreen = document.getElementById("startScreen");
    const withdrawScreen = document.getElementById("withdrawScreen");

    const totalCountEl = document.getElementById("totalCount");
    const topBalanceEl = document.getElementById("topBalance");
    const startTotalEl = document.getElementById("startTotal");
    const withdrawTotalEl = document.getElementById("withdrawTotal");
    const balanceDisplay = document.getElementById("balanceDisplay");
    const withdrawAmount = document.getElementById("withdrawAmount");
    const withdrawBtn = document.getElementById("withdrawBtn");

    const ltcAddress = document.getElementById("ltcAddress");

    const energyBar = document.getElementById("energyBar");
    const energyText = document.getElementById("energyText");
    const rechargeBtn = document.getElementById("rechargeBtn");
    const currentScoreEl = document.getElementById("currentScore");

    // ---------------------------
    // TMA Reward Ads Initialization
    // ---------------------------
    let tmaShowAd = null;

    window.initCdTma?.({ id: "6101858" })
      .then(show => { 
        tmaShowAd = show;
        console.log("TMA Ready"); 
      })
      .catch(e => console.log("TMA Init Error:", e));

    function playTMAReward() {
      if (!tmaShowAd) {
        Telegram.WebApp.showAlert("âš  Ad not ready yet, try again!");
        return;
      }

      tmaShowAd()
        .then(() => {
          energy = MAX_ENERGY;
          updateEnergy();
          Telegram.WebApp.showAlert("âš¡ Energy Full!");
        })
        .catch(e => console.log("TMA Ad Error", e));
    }

    // ---------------------------
    // GAME LOGIC
    // ---------------------------
    function updateEnergy() {
      energyBar.style.width = (energy / MAX_ENERGY * 100) + "%";
      energyText.textContent = `Energy: ${energy} / ${MAX_ENERGY}`;
      rechargeBtn.classList.toggle("show", energy === 0);
    }

    function updateAll() {
      const dollars = (totalScore / 100000).toFixed(2);

      totalCountEl.textContent = totalScore;
      topBalanceEl.textContent = dollars;
      startTotalEl.textContent = totalScore;
      withdrawTotalEl.textContent = totalScore;
      balanceDisplay.textContent = dollars;
      withdrawAmount.textContent = dollars;

      withdrawBtn.disabled = !(parseFloat(dollars) >= 1 && ltcAddress.value.trim());
    }

    function startTapping() {
      isTapping = true;
      startScreen.style.display = "none";
      currentScore = 0;
      currentScoreEl.textContent = "0";
      energy = MAX_ENERGY;
      updateEnergy();
    }

    function tap() {
      if (!isTapping || energy <= 0) return;

      energy--;
      currentScore++;
      totalScore++;

      currentScoreEl.textContent = currentScore;
      localStorage.setItem(TOTAL_SCORE_KEY, totalScore);

      updateEnergy();
      updateAll();
    }

    function openWithdraw() {
      startScreen.style.display = "none";
      withdrawScreen.style.display = "block";
      updateAll();
    }

    function closeWithdraw() {
      withdrawScreen.style.display = "none";
      if (!isTapping) startScreen.style.display = "block";
    }

    withdrawBtn.onclick = () => {
      Telegram.WebApp.showAlert("Withdraw Request Sent to Admin!");
      totalScore = 0;
      localStorage.setItem(TOTAL_SCORE_KEY, "0");
      closeWithdraw();
      updateAll();
    };

    updateEnergy();
    updateAll();
  </script>

</body>
</html>
